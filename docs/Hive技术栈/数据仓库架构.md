# 数据仓库架构

<center><img src='https://cdn.jsdelivr.net/gh/weno861/image/img/202402052025034.png'></center>

**为什么要进行数据分层**

* **减少重复开发**:规范数据分层，开发一些通用的中间层数据，能够减少开发
* **数据血缘追踪**:如果数据出现问题时，可以快速定位到数据出现问题的数据层
* **清晰数据结构**:数据仓库中的每个分层都有它的作用域和职责，在使用表时可以更方便地定位和理解

**数据仓库分层的好处:**

* **复杂问题简单化**:将一个复杂任务分解成多个步骤来完成，数据仓库的每一层能解决特定的问题
* **便于维护**:当数据出现问题时，只需要从存在问题的数据层开始修复

## ETL层

* 数据仓库ETL主要用于完成数据接入的过程，即从业务系统或其他数据源中提取数据，并进行数据清洗、转换和加载
* 数据抽取是指从源数据系统中抽取数据到目标数据系统，一般可以通过现成的工具来完成，如sqoop和kettle等
* 数据转换是指将抽取的数据进行清洗、标准化和加工等操作

**ETL和ELT的区别**
1. **数据位置：** ETL在数据抽取之后进行转换，然后加载到目标系统；而ELT将数据直接加载到目标系统，然后在目标系统内进行转换。
2. **用途：** ETL更适用于需要在传输过程中清理和转换数据的场景，而ELT更适用于将数据快速加载到目标系统，然后在目标系统内进行更复杂的处理。
3. **性能：** ELT通常具有更好的性能，因为数据加载到目标系统后，可以利用目标系统的处理能力进行转换，而不是在传输过程中进行。
4. **灵活性：** ETL通常提供更多的灵活性，因为转换可以在抽取和加载的过程中进行，而不受目标系统的限制。
5. **目标系统：** ETL通常用于传统的数据仓库场景，而ELT更适用于分布式计算平台或云数据仓库等现代架构。

在选择ETL或ELT时，需要考虑业务需求、目标系统的性能和可用性，以及数据集成流程的复杂性。在某些情况下，也可以采用混合模式，根据实际需求选择使用ETL或ELT的组合

## ODS层

* ODS层基本上就是将数据从源表拉过来，进行ETL
* ODS层的数据，总体上大多数是按照源头业务系统的分类方式而分类的，这一层面的数据不等同于源数据

## 数据仓库层

数据仓库层从ODS层获得的数据按照主题建立各种数据模型，这一层和维度建模关系较深

数据仓库层可细分为以下三个类别:

* **数据明细层(DWD)**
* **数据中间层(DWM)**
* **数据服务层(DWS)**

### DWD（Data Warehouse Detail）

这一层也被称为明细数据层或详细数据层，主要用于**存储从各种源系统经过ETL处理后的原始数据**。DWD层的数据通常是非聚合的，保持着比较高的粒度。这个层次的数据通常用于后续的数据分析和数据挖掘过程中的深入研究。

### DWM（Data Warehouse Model）

这一层也被称为数据仓库模型层或数据模型层，是在DWD层之上的中间层。在这一层，数据通过进一步的转换和整合，被构建成为特定的数据模型，如星型模式或雪花模式。**DWM层的数据通常更适合于分析和报告**，因为它们已经被组织成更易于理解和查询的格式

### DWS（Data Warehouse Service

这一层也称为服务数据层或聚合数据层，主要用于**存储经过进一步加工和聚合的数据**，以支持快速的查询和报告需求。在DWS层，数据通常被处理成更高级的汇总形式，例如按月份、区域或产品类别的销售总额。这样的数据非常适用于业务智能（BI）应用和决策支持系统

> **数据集市和宽表的概念**
>
> * 数据集市和宽表通常位于数据仓库架构中接近最终用户的层面，也就是在数据中间层层和数据服务层之间
> * 数据集市是数据仓库的一个子集，通常针对特定的业务领域、部门或用户群体。它包含了为满足这些特定需求而定制化的数据。数据集市可能位于DWM层，也可能是DWS层的一部分，具体取决于其在数据仓库架构中的具体实现和用途。数据集市的数据一般已经过处理和优化，以便快速响应特定的查询和报告需求
> * 宽表是一种**包含多个维度和度量**的数据表，通常用于数据分析和报告。在数据仓库架构中，宽表通常出现在数据服务层，因为它们整合了多个维度的数据，以便于快速查询和分析。宽表通过减少需要进行的表连接操作来提高查询效率，从而加快报告和分析的速度
>   * 如何构建宽表
>     * **明确需求：** 首先，确保了解业务需求和分析目标。明确需要哪些数据，以及数据之间的关系。
>     * **识别关键实体：** 确定需要包含在宽表中的关键实体或主题。这可以是客户、产品、交易等业务实体。
>     * **定义关联：** 确定关键实体之间的关联关系。这包括主键和外键之间的关系，以便在合并表时进行连接。
>     * **选择字段：** 选择每个表中需要包含在宽表中的字段。这通常包括关键实体的标识符、属性以及用于关联的外键。
>     * **处理重复字段：** 处理不同表中可能存在的相同字段，确保它们在合并后没有冲突。可以通过为字段添加前缀或使用别名来解决这个问题。
>     * **处理缺失值：** 考虑如何处理合并后可能出现的缺失值。这可能涉及到选择合适的默认值或者使用插值方法来填充缺失值。
>     * **选择合适的合并方式：** 根据关联关系选择合适的合并方式，例如内连接、左连接、右连接或全连接。这取决于你希望保留哪些数据。
>     * **性能优化：** 考虑宽表的性能优化，包括索引的添加以加速查询。
>     * **测试和验证：** 在实际构建宽表之前，进行测试和验证确保合并后的数据满足业务需求，并且查询性能良好。
>     * **文档化：** 记录宽表的结构、字段含义和任何处理方法，以便其他人能够理解和使用它。
> * 数据集市和宽表的主要目的是为了**提高数据访问的效率和方便性**，使得最终用户能够更容易地进行数据分析和决策支持
> * **层级关系：** 数据集市通常是数据仓库的子集，而宽表可以存在于整个数据仓库中，不仅限于某个业务领域。
> * **关联性：** 宽表可能由多个数据集市的数据合并而来，但并不是所有宽表都与数据集市直接相关。
> * **应用场景：** 数据集市通常更专注于满足某个业务领域的详细需求，而宽表更适用于跨足多个业务领域的综合性分析

## 数据应用层

这一层是数据仓库架构的前端，包括了数据分析、业务智能报告、数据可视化工具等。这一层的目的是为了使最终用户能够容易地访问和解读数据，从而支持更好的决策制定